name: Generate website
on:
  workflow_call:
    secrets:
      GH_PAT:
        required: true
        description: "Github personal access token"
      AUTHOR_EMAIL:
        required: false
        description: "The author email"
      AUTHOR_NAME:
        required: false
        description: "The author name"
    inputs:
      site_name:
        type: string
        required: true
        description: "The name of the site"
      site_url:
        type: string
        required: true
        description: "The url of the site"
      site_description:
        type: string
        required: true
        description: "The description of the site"
      site_author:
        type: string
        required: true
        description: "The author of the site"
      language:
        type: string
        required: true
        description: "The language of the site"
      auto_h1:
        type: boolean
        required: false
        description: "Automatically add h1 to pages"
        default: false
      comments:
        type: boolean
        required: false
        description: "Enable comments"
        default: false
      template_type:
        description: "The template type"
        required: true
        default: "gh_pages"
        type: choice
        options:
          - "gh_pages"
          - "netlify"
          - "vercel"




jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - name: Print inputs
        run: |
          echo "ðŸ“« Commands arguments" >> $GITHUB_STEP_SUMMARY
          echo "- site_name: ${{ inputs.site_name }}" >> $GITHUB_STEP_SUMMARY
          echo "- site_url: ${{ inputs.site_url }}" >> $GITHUB_STEP_SUMMARY
          echo "- site_description: ${{ inputs.site_description }}" >> $GITHUB_STEP_SUMMARY
          echo "- site_author: ${{ inputs.site_author }}" >> $GITHUB_STEP_SUMMARY
          echo "- language: ${{ inputs.language }}" >> $GITHUB_STEP_SUMMARY
          echo "- auto_h1: ${{ inputs.auto_h1 }}" >> $GITHUB_STEP_SUMMARY
          echo "- comments: ${{ inputs.comments }}" >> $GITHUB_STEP_SUMMARY
      - name: Checkout
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'
      - name: Install dependencies
        run: |
          pip install pydantic
      - name: Format arguments
        id: args
        run:
          |
          auto_h1=''
          comments=''
          if [ "${{ inputs.auto_h1 }}" = "true" ]; then
            auto_h1='--auto-h1'
          fi
          if [ "${{ inputs.comments }}" = "true" ]; then
            comments='--comments'
          fi
          echo "auto_h1=$auto_h1" >> $GITHUB_OUTPUT
          echo "comments=$comments" >> $GITHUB_OUTPUT
      - name: Generate files
        run: |
          echo "ðŸ“ Generate files" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          python template.py "${{inputs.template_type}}" "${{inputs.site_name}}" "${{inputs.site_url}}" "${{inputs.site_description}}" "${{inputs.site_author}}" "${{inputs.language}}" ${{ steps.args.outputs.auto_h1 }} ${{ steps.args.outputs.comments }} >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
      - name: "Push"
        if: ${{ !env.ACT}}
        uses: actions-js/push@master
        with:
          github_token: ${{ secrets.GH_PAT }}
          author_email: ${{ secrets.AUTHOR_EMAIL || 'github-actions[bot]@users.noreply.github.com' }}
          author_name: ${{ secrets.AUTHOR_NAME || 'github-actions[bot]' }}





